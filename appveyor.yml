version: 1.BETA.{build}
# skip_tags is important or you will get an infinite build loop when we apply release tags
skip_tags: true
skip_branch_with_pr: true

environment:
  svn_url: https://svn.code.sf.net/p/stones2stars/code/trunk
  release_prefix: Stones2Stars
  build_dir: _build
  release_branch: release

build_script:
  - cmd: >-
      call Powershell.exe -NoProfile -ExecutionPolicy Bypass -File "%APPVEYOR_BUILD_FOLDER%\Tools\CI\fix_sources_timestamps.ps1"

      call "%APPVEYOR_BUILD_FOLDER%\Tools\_AppveyorTestBuild.bat"

test_script:
  - cmd: >-
      cd Tools

      XmlValidator.exe -a

deploy_script:
  - cmd: >-
      call "%APPVEYOR_BUILD_FOLDER%\Tools\CI\DeployBuild.bat"

      call "%APPVEYOR_BUILD_FOLDER%\Tools\_TrimFBuildCache.bat"

notifications:
  - provider: Slack
    incoming_webhook:
      secure: /rZsiy2rHhDaEh9f3Hzv6RtkcI/grO+svFlzo0AErpTBOfM0e2IDGzUVemKjvU2uQhUIL+t9TgYCItXIAcTIlAuZUgbXxJJGTQn4eJ+tkgM0Ze6dt+JSvb3H5nndmk9epWUr89PASEMdwTgw3nuJJe4f7TveskQwWbS1XNEX0lF5i/B8wj+TS5uIqZQPD/wP
    channel: github
    on_build_success: true
    on_build_failure: true
    on_build_status_changed: false
